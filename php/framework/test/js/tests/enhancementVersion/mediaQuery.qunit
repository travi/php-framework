(function (fwork) {
    "use strict";

    var enhancementVersionConstants = fwork.constants();

    module("Screen width based version", {
        teardown: function () {
            fwork.cookies.clearAll();
        }
    });

    test("Enhancement version cookie name defined as what server is expecting", function () {
        strictEqual(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY, "enhancementVersion");
    });

    test("Mobile enhancement version cookie value defined as what server is expecting", function () {
        strictEqual(enhancementVersionConstants.MOBILE_ENHANCEMENT_VERSION, "mobile");
    });

    test("Desktop enhancement version cookie value defined as what server is expecting", function () {
        strictEqual(enhancementVersionConstants.DESKTOP_ENHANCEMENT_VERSION, "desktop");
    });

    test("Enhancement version set to mobile when screen width reported within smartphone range", function () {
        Modernizr.init();
        Modernizr.expect(
            'mq',
            {
                withValue: 'only screen and (min-width: 320px) and (max-width: 480px)',
                returnValue: true
            }
        );
        fwork.location.init();
        fwork.location.expect('refresh');

        fwork.init();

        ok(Modernizr.verify());
        strictEqual('mobile', fwork.cookies.value(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY));
        ok(fwork.location.verify(), "reloads to get proper resources");
    });

    test("Enhancement version set to desktop at higher screen width", function () {
        Modernizr.init();
        Modernizr.expect(
            'mq',
            {
                withValue: 'only screen and (min-width: 320px) and (max-width: 480px)',
                returnValue: false
            }
        );
        fwork.location.init();
        fwork.location.expect('refresh');

        fwork.init();

        ok(Modernizr.verify());
        strictEqual('desktop', fwork.cookies.value(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY));
        ok(fwork.location.verify(), "reloads to get proper resources");
    });

    test("cookie not set if already set", function () {
        var existingCookieValue = 'test';

        fwork.cookies.create(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY, existingCookieValue, 10);

        fwork.init();

        strictEqual(existingCookieValue, fwork.cookies.value(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY));
    });
}(travi.framework));
