(function (fwork) {
    "use strict";

    var enhancementVersionConstants = fwork.constants();

    module("Screen width based version", {
        setUp: function () {
            console.log('here');
            sinon.stub(travi.templates, 'get');
        },
        teardown: function () {
            travi.cookies.clearAll();
            travi.test.common.restore([
                Modernizr.mq
            ]);
        }
    });

    test("Enhancement version cookie name defined as what server is expecting", function () {
        strictEqual(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY, "enhancementVersion");
    });

    test("Mobile enhancement version cookie value defined as what server is expecting", function () {
        strictEqual(enhancementVersionConstants.MOBILE_ENHANCEMENT_VERSION, "mobile");
    });

    test("Desktop enhancement version cookie value defined as what server is expecting", function () {
        strictEqual(enhancementVersionConstants.DESKTOP_ENHANCEMENT_VERSION, "desktop");
    });

    test("Enhancement version set to mobile when screen width reported within smartphone range", function () {
        sinon.stub(Modernizr, 'mq').returns(true);
        sinon.stub(travi.location, 'refresh');

        fwork.init();

        sinon.assert.calledWith('only screen and (min-width: 320px) and (max-width: 480px)');
        sinon.assert.calledOnce(travi.location.refresh);
        strictEqual('mobile', fwork.cookies.value(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY));
        ok(fwork.location.verify(), "reloads to get proper resources");
    });

    test("Enhancement version set to desktop at higher screen width", function () {
        sinon.stub(Modernizr, 'mq').returns(false);
        sinon.stub(travi.location, 'refresh');
        Modernizr.expect(
            'mq',
            {
                withValue: 'only screen and (min-width: 320px) and (max-width: 480px)',
                returnValue: false
            }
        );
        fwork.location.init();
        fwork.location.expect('refresh');

        fwork.init();

        sinon.assert.calledWith('only screen and (min-width: 320px) and (max-width: 480px)');
        sinon.assert.notCalled(travi.location.refresh);
        strictEqual('desktop', fwork.cookies.value(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY));
        ok(fwork.location.verify(), "reloads to get proper resources");
    });

    test("cookie not set if already set", function () {
        var existingCookieValue = 'test';

        travi.cookies.create(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY, existingCookieValue, 10);

        fwork.init();

        strictEqual(existingCookieValue, travi.cookies.value(enhancementVersionConstants.ENHANCEMENT_VERSION_KEY));
    });
}(travi.framework));
