"use strict";

$(document).ready(function () {
    $('#confirmation').dialog('destroy');
    $('#confirmation').remove();
});


module("POST handling for 'Remove' action", {
	setup: function () {
		$('body').append('<div id="scratch">');
        $('#scratch')
            .append('<ol class="entityList">' +
                        '<li class="remove-item">' +
                            '<form action="index.php" class="item-action" method="post">' +
                                '<input type="hidden" name="id" value="45" />' +
                                '<input type="hidden" name="Submit" value="Remove" />' +
                                '<input type="submit" value="Remove" />' +
                            '</form>' +
                        '</li>' +
                    '</ol>');
        travi.framework.entityList.init();
    },
    teardown: function () {
        $('#scratch').remove();
        $('#confirmation').dialog('destroy').remove();
	}
});
test("Form conversion to link", function () {
	//Setup
    $('form').unbind('submit').submit(function () {
        $('#scratch').append('<div id="submitVerify">form submitted</div>');
        return false;
    });
	expect(4);

    //Exercise
    $('a.item-action').click();

	//Verify
    same($('form').length, 1, 'form exists');
    ok($('form').is(':not(:visible)'), "form no longer visible");
    ok($("li.remove-item a.item-action").is(':visible'), "link visible");
    same($('#submitVerify').length, 1, "click submits form");
});
test("Ajax submittion", function () {
    ok(false, 'missing functionality');
});
module("Remove Confirmation", {
	setup: function () {
		$('body').append('<div id="scratch">');
        $('#scratch')
            .append('<ol class="entityList">' +
                        '<li class="remove-item">' +
                            '<form action="index.php" class="item-action" method="post">' +
                                '<input type="hidden" name="id" value="45" />' +
                                '<input type="hidden" name="Submit" value="Remove" />' +
                                '<input type="submit" value="Remove" />' +
                            '</form>' +
                        '</li>' +
                    '</ol>');
        travi.framework.entityList.init();
    },
    teardown: function () {
        $('#scratch').remove();
        $('#confirmation').dialog('destroy').remove();
	}
});
test("confirmation dialog", function () {
	//Setup
	expect(5);

	//Verify
    same($('#confirmation').length, 1, 'confirmation div exists');
    ok($('#confirmation').is(':not(:visible)'), "confirmation not shown");

    //Exercise
    $('form').submit();

    //Verify
    ok($('#confirmation').is(':visible'), "confirmation shown");
    same($('div.ui-widget-overlay').length, 1, 'is modal');
    same($('#confirmation').dialog('option', 'modal'), true, 'is modal');
});
test("confirmation button text", function () {
	//Setup
    travi.framework.entityList.setButtonText('Remove');
    $('form').submit();
	expect(2);

	//Verify
    same(travi.framework.entityList.getButtonText(), 'Remove', "Button text reported correctly");
    same($('#confirmation').dialog('option', 'buttons')[0].text, 'Remove', "Button text displayed correctly");
});
test("confirmation message", function () {
	//Setup
    travi.framework.entityList.setConfirmationMessage('Are you sure you wish to REMOVE this announcement?');
	expect(2);

	//Verify
    same($('#confirmation').text(), 'Are you sure you wish to REMOVE this announcement?',
            "Confirmation message correct");
    same($('#confirmation').dialog('option', 'title'), 'Are you sure?', "Title text correct");
});
module("Paging", {
	setup: function () {
		$('body').append('<div id="scratch">');
        $('#scratch')
            .append('<ol class="entityList">' +
                        '<li class="remove-item">' +
                            '<form action="index.php" class="item-action" method="post">' +
                                '<input type="hidden" name="id" value="45" />' +
                                '<input type="hidden" name="Submit" value="Remove" />' +
                                '<input type="submit" value="Remove" />' +
                            '</form>' +
                        '</li>' +
                    '</ol>');
        travi.framework.entityList.init();
    },
    teardown: function () {
        $('#scratch').remove();
        $('#confirmation').dialog('destroy').remove();
	}
});
test("Ajax load", function () {
    ok(false, 'missing functionality');
    ok(false, 'markup built properly from template');
});
test("'back' link visibility", function () {
    ok(false, 'missing functionality');
});
test("'forward' link visibility", function () {
    ok(false, 'missing functionality');
});