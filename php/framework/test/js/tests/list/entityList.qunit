(function () {
    "use strict";


    $(document).ready(function () {
        $('#confirmation').dialog('destroy');
        $('#confirmation').remove();
    });

    $.mockjax({
        url: "/admin/updates/45",
        contentType: 'text/json',
        responseText: {test: "test"}
    });


    module("POST handling for 'Remove' action", {
        setup: function () {
            $('body').append('<div id="scratch">');
            $('#entity-list').tmpl().appendTo('#scratch');
            travi.framework.entityList.init();
        },
        teardown: function () {
            $('#scratch').remove();
            $('#confirmation').dialog('destroy').remove();
        }
    });
    test("Form conversion to link", function () {
        //Setup
        $('form').unbind('submit').submit(function () {
            $('#scratch').append('<div id="submitVerify">form submitted</div>');
            return false;
        });
        expect(4);

        //Exercise
        $('a.item-action').click();

        //Verify
        strictEqual($('form').length, 1, 'form exists');
        ok($('form').is(':not(:visible)'), "form no longer visible");
        ok($("li.remove-item a.item-action").is(':visible'), "link visible");
        strictEqual($('#submitVerify').length, 1, "click submits form");
    });
    test("Ajax submission", function () {
        expect(2);
        $('#scratch').bind('entityRemoved', function () {
            strictEqual($('.entityList>li').length, 0, 'Entity removed from list');
            start();
        });
        $('a.item-action').click();
        strictEqual($('.entityList>li').length, 1, 'Correct starting number of entities in list');

        //Exercise
        stop();
        $('.ui-dialog-buttonpane button').eq(0).click();
    });
    module("Remove Confirmation", {
        setup: function () {
            $('body').append('<div id="scratch">');
            $('#entity-list').tmpl().appendTo('#scratch');
            travi.framework.entityList.init();
        },
        teardown: function () {
            $('#scratch').remove();
            $('#confirmation').dialog('destroy').remove();
        }
    });
    test("confirmation dialog", function () {
        //Setup
        expect(5);

        //Verify
        strictEqual($('#confirmation').length, 1, 'confirmation div exists');
        ok($('#confirmation').is(':not(:visible)'), "confirmation not shown");

        //Exercise
        $('form').submit();

        //Verify
        ok($('#confirmation').is(':visible'), "confirmation shown");
        strictEqual($('div.ui-widget-overlay').length, 1, 'is modal');
        strictEqual($('#confirmation').dialog('option', 'modal'), true, 'is modal');
    });
    test("confirmation button text", function () {
        //Setup
        travi.framework.entityList.setButtonText('Remove');
        $('form').submit();
        expect(2);

        //Verify
        strictEqual(travi.framework.entityList.getButtonText(), 'Remove', "Button text reported correctly");
        strictEqual($('#confirmation').dialog('option', 'buttons')[0].text, 'Remove', "Button text displayed correctly");
    });
    test("confirmation message", function () {
        //Setup
        travi.framework.entityList.setConfirmationMessage('Are you sure you wish to REMOVE this announcement?');
        expect(2);

        //Verify
        strictEqual($('#confirmation').text(), 'Are you sure you wish to REMOVE this announcement?',
                "Confirmation message correct");
        strictEqual($('#confirmation').dialog('option', 'title'), 'Are you sure?', "Title text correct");
    });
    module("Paging", {
        setup: function () {
            $('body').append('<div id="scratch">');
            $('#entity-list').tmpl().appendTo('#scratch');
            travi.framework.entityList.init();
        },
        teardown: function () {
            $('#scratch').remove();
            $('#confirmation').dialog('destroy').remove();
        }
    });
    test("Ajax load", function () {
        ok(false, 'missing functionality');
        ok(false, 'markup built properly from template');
    });
    test("'back' link visibility", function () {
        ok(false, 'missing functionality');
    });
    test("'forward' link visibility", function () {
        ok(false, 'missing functionality');
    });
}());